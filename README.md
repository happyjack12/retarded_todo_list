## Автор

- Akhmedov Jacob — [github.com/Jacobamv](https://github.com/Jacobamv) · jecob.akhmedov@gmail.com

## Структура Проекта

- **Корень**
  - `pyproject.toml` — настройки Poetry, зависимости и описание пакета.
  - `poetry.lock` — зафиксированные версии всех библиотек.
  - `README.md` — общее описание проекта и инструкции.
  - `Makefile` — упрощённые команды для типовых операций.
  - `Dockerfile`, `docker-compose.yml` — контейнеризация приложения.
  - `alembic.ini` — конфигурация Alembic для миграций БД.

- **`app/`**
  - `__init__.py` — пометка каталога как пакета.
  - `main.py` — точка входа FastAPI-приложения (создание `FastAPI`, подключение роутеров).
  - `core/`
    - `config.py` — конфигурация приложения (переменные окружения, настройки базы).
    - `security.py` — функции безопасности (JWT, хэширование и т.п.).
  - `db/`
    - `__init__.py`
    - `base.py` — базовые декларации ORM (если объединяются модели).
    - `session.py` — создание сессий SQLAlchemy.
    - `migrations/` — инфраструктура Alembic.
      - `env.py`, `script.py.mako` — служебные файлы Alembic.
      - `versions/` — миграции.
        - `20231109_0001_create_users.py` — пример миграции таблицы пользователей.
  - `handler/`
    - `router.py` — сборка и подключение всех маршрутов (FastAPI `APIRouter`).
    - `ping/`
      - `ping.py` — обработчики ping-эндпоинтов.
    - `user/`
      - `login.py` — обработчики пользовательских маршрутов (например, логин).
  - `models/`
    - `user.py` — ORM-модель пользователя; дополнительные модели размещаются рядом.
  - `repository/`
    - `ping/`
      - `pingCheck.py` — доступ к данным/проверки для ping-модуля.
    - `user/`
      - `getUserByUsername.py` — запросы к БД для пользователей.
  - `schemas/`
    - `user.py` — Pydantic-DTO для пользователей; другие DTO добавляйте сюда.
  - `service/`
    - `ping/`
      - `pingService.py` — бизнес-логика ping-модуля.
    - `user/`
      - `login.py` — бизнес-логика для логина.

## Добавление Нового Роута

- **Маршрут**
  - В `app/handler/<feature>/` создайте файл `<action>.py` с функциями FastAPI (`APIRouter` или зависимостями).
  - Зарегистрируйте новый роутер в `app/handler/router.py`, подключив его к общему `APIRouter`.

- **Бизнес-логика**
  - Разместите сервисный код в `app/service/<feature>/`. Здесь остаётся логика без HTTP-зависимостей.

- **Доступ к данным**
  - Используйте `app/repository/<feature>/` для работы с БД (SQLAlchemy-сессии, запросы).

- **DTO (Pydantic-схемы)**
  - Все входные/выходные модели расположите в `app/schemas/<feature>.py`.
  - DTO импортируйте в хэндлеры и сервисы для строгой типизации.

- **Модели**
  - Если требуется новая ORM-модель, добавьте её в `app/models/<feature>.py` и зарегистрируйте в `app/db/base.py` (если там поддерживается общий список моделей).

- **Миграции**
  - После изменения моделей создайте миграцию командой `alembic revision --autogenerate -m "описание"` и примените `alembic upgrade head`.

Такое разделение позволяет поддерживать чистую архитектуру: хэндлеры отвечают за HTTP, сервисы — за бизнес-правила, репозитории — за данные, DTO/Pydantic — за контракты между слоями.

## Логирование

- `LOG_DESTINATION` — `stdout` (по умолчанию), `file` или `both` для выбора вывода.
- `LOG_FILE_PATH` — путь к файлу логов, обязателен при `LOG_DESTINATION=file|both`.
- При отсутствии `.env` настройки читаются из системных переменных окружения.